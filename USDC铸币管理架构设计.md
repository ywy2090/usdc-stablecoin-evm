# USDC é“¸å¸ç®¡ç†æ¶æ„è®¾è®¡æ–‡æ¡£

## ç›®å½•
- [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
- [å››å±‚æ¶æ„è¯¦è§£](#å››å±‚æ¶æ„è¯¦è§£)
- [è®¾è®¡ç›®çš„å’Œä¼˜åŠ¿](#è®¾è®¡ç›®çš„å’Œä¼˜åŠ¿)
- [å®é™…æ“ä½œæµç¨‹](#å®é™…æ“ä½œæµç¨‹)
- [ä»£ç å®ç°](#ä»£ç å®ç°)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ¶æ„æ¦‚è§ˆ

USDC é‡‡ç”¨**å››å±‚é“¸å¸ç®¡ç†æ¶æ„**ï¼Œè¿™æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„æƒé™åˆ†å±‚ç³»ç»Ÿï¼Œå¹³è¡¡äº†å®‰å…¨æ€§ã€çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚

### æ¶æ„å±‚æ¬¡å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Layer 0: Owner                      â”‚
â”‚              (Circle æœ€é«˜æƒé™ - å†·é’±åŒ…å­˜å‚¨)                â”‚
â”‚   æƒé™: è®¾ç½® MasterMinterã€æ›´æ¢ Ownerã€ç´§æ€¥æƒé™           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ æŒ‡å®š
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Layer 1: MasterMinter                      â”‚
â”‚              (ä¸»é“¸å¸ç®¡ç†å™¨ - ç‹¬ç«‹åˆçº¦)                     â”‚
â”‚   æƒé™: é…ç½®/ç§»é™¤ Controllersã€ç®¡ç†æ•´ä½“é“¸å¸ç­–ç•¥            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ ç®¡ç†å¤šä¸ª
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Layer 2: Controllers (æ§åˆ¶å™¨å±‚)               â”‚
â”‚        (å¤šä¸ªæ§åˆ¶å™¨ - å¯èƒ½æ˜¯ä¸åŒåœ°åŒº/éƒ¨é—¨/ä¸šåŠ¡)              â”‚
â”‚   æƒé™: é…ç½®é“¸å¸é¢åº¦ã€å¢å‡é¢åº¦ã€ç§»é™¤è‡ªå·±çš„ Minter          â”‚
â”‚                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ Controller 1 â”‚  â”‚ Controller 2 â”‚  â”‚ Controller N â”‚â”‚
â”‚   â”‚  (ç¾å›½åœ°åŒº)   â”‚  â”‚  (æ¬§æ´²åœ°åŒº)   â”‚  â”‚  (äºšæ´²åœ°åŒº)   â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ å„è‡ªç®¡ç†          â”‚                  â”‚
           â†“                  â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Layer 3: Minters (é“¸å¸è€…å±‚)                  â”‚
â”‚            (å®é™…æ‰§è¡Œé“¸å¸æ“ä½œçš„åœ°å€)                         â”‚
â”‚                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ Minter 1 â”‚  â”‚ Minter 2 â”‚  â”‚ Minter 3 â”‚  â”‚Minter Nâ”‚â”‚
â”‚   â”‚ (çƒ­é’±åŒ…)  â”‚  â”‚ (è‡ªåŠ¨åŒ–)  â”‚  â”‚ (å¤‡ç”¨)    â”‚  â”‚ (...)  â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
         â”‚ å®é™…é“¸å¸     â”‚             â”‚              â”‚
         â†“             â†“             â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   USDC Token Contract                  â”‚
â”‚              totalSupply += mintAmount                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¦‚å¿µ

| å±‚çº§ | åç§° | æ•°é‡ | æƒé™èŒƒå›´ | å­˜å‚¨æ–¹å¼ |
|-----|------|------|---------|---------|
| **Layer 0** | Owner | 1 | æœ€é«˜æƒé™ | å†·é’±åŒ…ï¼ˆå¤šç­¾ï¼‰ |
| **Layer 1** | MasterMinter | 1 | ç­–ç•¥ç®¡ç† | ç‹¬ç«‹åˆçº¦ |
| **Layer 2** | Controllers | N | åŒºåŸŸç®¡ç† | çƒ­é’±åŒ…/å¤šç­¾ |
| **Layer 3** | Minters | N | æ‰§è¡Œé“¸å¸ | çƒ­é’±åŒ…/è‡ªåŠ¨åŒ– |

---

## å››å±‚æ¶æ„è¯¦è§£

### ğŸ”· Layer 0: Owner - æœ€é«˜æƒé™å±‚

#### è§’è‰²å®šä½
Circle å…¬å¸çš„æœ€é«˜æƒé™æ§åˆ¶è€…ï¼Œé€šå¸¸æ˜¯**å†·é’±åŒ…å¤šç­¾**ï¼ˆå¦‚ Gnosis Safeï¼‰ï¼Œç¡®ä¿æœ€é«˜å®‰å…¨æ€§ã€‚

#### æ ¸å¿ƒæƒé™

```solidity
// ========== æˆ˜ç•¥çº§æƒé™ ==========

// 1. è®¾ç½® MasterMinterï¼ˆæœ€å…³é”®çš„æƒé™ï¼‰
function updateMasterMinter(address _newMasterMinter) external onlyOwner {
    require(
        _newMasterMinter != address(0),
        "FiatToken: new masterMinter is the zero address"
    );
    masterMinter = _newMasterMinter;
    emit MasterMinterChanged(masterMinter);
}

// 2. è½¬ç§»æ‰€æœ‰æƒ
function transferOwnership(address newOwner) external onlyOwner {
    require(
        newOwner != address(0),
        "Ownable: new owner is the zero address"
    );
    emit OwnershipTransferred(_owner, newOwner);
    setOwner(newOwner);
}

// 3. æ›´æ¢å…¶ä»–å…³é”®è§’è‰²
function updatePauser(address _newPauser) external onlyOwner;
function updateBlacklister(address _newBlacklister) external onlyOwner;
function updateRescuer(address newRescuer) external onlyOwner;

// 4. åˆçº¦å‡çº§ï¼ˆé€šè¿‡ä»£ç†åˆçº¦ï¼‰
function upgradeTo(address newImplementation) external; // ç”± ProxyAdmin è°ƒç”¨
```

#### èŒè´£èŒƒå›´

âœ… **éœ€è¦ Owner å‚ä¸çš„æ“ä½œ**:
- è®¾ç½®æˆ–æ›´æ¢ MasterMinter åœ°å€
- è½¬ç§»åˆçº¦æ‰€æœ‰æƒ
- æ›´æ¢ Pauserã€Blacklisterã€Rescuer
- åˆçº¦å‡çº§
- ç´§æ€¥æƒ…å†µä¸‹çš„ç»ˆæå†³ç­–

âŒ **ä¸éœ€è¦ Owner å‚ä¸çš„æ“ä½œ**:
- æ—¥å¸¸é“¸å¸æ“ä½œ
- è°ƒæ•´é“¸å¸é¢åº¦
- é…ç½®æ§åˆ¶å™¨
- æ—¥å¸¸è¿è¥ç®¡ç†

#### å®‰å…¨è€ƒè™‘

```
Owner å®‰å…¨æªæ–½:
â”œâ”€ å†·é’±åŒ…å­˜å‚¨ï¼ˆç¦»çº¿ä¿ç®¡ï¼‰
â”œâ”€ å¤šç­¾æœºåˆ¶ï¼ˆå¦‚ 3/5 Gnosis Safeï¼‰
â”œâ”€ ç‰©ç†éš”ç¦»ï¼ˆä¸åŒåœ°ç†ä½ç½®ï¼‰
â”œâ”€ è®¿é—®å®¡è®¡ï¼ˆæ‰€æœ‰æ“ä½œè®°å½•ï¼‰
â””â”€ æœ€å°åŒ–ä½¿ç”¨é¢‘ç‡ï¼ˆåªåœ¨å¿…è¦æ—¶ä½¿ç”¨ï¼‰
```

---

### ğŸ”· Layer 1: MasterMinter - ä¸»é“¸å¸ç®¡ç†å™¨

#### æ¶æ„è®¾è®¡

```solidity
/**
 * @title MasterMinter - ä¸»é“¸å¸ç®¡ç†å™¨
 * @notice ä½¿ç”¨ Owner-Controller-Worker æ¨¡å‹ç®¡ç†é“¸å¸è€…
 */
contract MasterMinter is MintController {
    // ç»§æ‰¿è‡ª Controller
    mapping(address => address) internal controllers;
    // controllers[controlleråœ°å€] = minteråœ°å€

    // æŒ‡å‘ FiatToken åˆçº¦
    MinterManagementInterface internal minterManager;

    constructor(address _minterManager) public MintController(_minterManager) {}
}
```

#### æ ¸å¿ƒåŠŸèƒ½

##### 1. é…ç½®æ§åˆ¶å™¨

```solidity
/**
 * @notice é…ç½®æ§åˆ¶å™¨åŠå…¶å¯¹åº”çš„é“¸å¸è€…
 * @dev åªæœ‰ Owner å¯ä»¥è°ƒç”¨
 * @param _controller æ§åˆ¶å™¨åœ°å€ï¼ˆä¸­é—´ç®¡ç†å±‚ï¼‰
 * @param _worker é“¸å¸è€…åœ°å€ï¼ˆå®é™…æ‰§è¡Œé“¸å¸ï¼‰
 */
function configureController(address _controller, address _worker)
    public
    onlyOwner
{
    require(_controller != address(0), "Controller must be a non-zero address");
    require(_worker != address(0), "Worker must be a non-zero address");

    controllers[_controller] = _worker;
    emit ControllerConfigured(_controller, _worker);
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```solidity
// é…ç½®ç¾å›½åœ°åŒºæ§åˆ¶å™¨
masterMinter.configureController(
    0xController_US,  // ç¾å›½åœ°åŒºæ§åˆ¶å™¨åœ°å€
    0xMinter_US       // ç¾å›½åœ°åŒºé“¸å¸è€…åœ°å€
);

// é…ç½®æ¬§æ´²åœ°åŒºæ§åˆ¶å™¨
masterMinter.configureController(
    0xController_EU,
    0xMinter_EU
);

// é…ç½®äºšæ´²åœ°åŒºæ§åˆ¶å™¨
masterMinter.configureController(
    0xController_ASIA,
    0xMinter_ASIA
);
```

##### 2. ç§»é™¤æ§åˆ¶å™¨

```solidity
/**
 * @notice ç¦ç”¨æ§åˆ¶å™¨ï¼ˆè®¾ç½®å…¶ worker ä¸ºé›¶åœ°å€ï¼‰
 * @param _controller è¦ç§»é™¤çš„æ§åˆ¶å™¨åœ°å€
 */
function removeController(address _controller) public onlyOwner {
    require(_controller != address(0), "Controller must be a non-zero address");
    require(
        controllers[_controller] != address(0),
        "Worker must be a non-zero address"
    );

    controllers[_controller] = address(0);
    emit ControllerRemoved(_controller);
}
```

##### 3. æŸ¥è¯¢æ§åˆ¶å™¨

```solidity
/**
 * @notice æŸ¥è¯¢æ§åˆ¶å™¨ç®¡ç†çš„é“¸å¸è€…
 */
function getWorker(address _controller) external view returns (address) {
    return controllers[_controller];
}

/**
 * @notice è·å– MinterManagerï¼ˆFiatTokenï¼‰
 */
function getMinterManager() external view returns (MinterManagementInterface) {
    return minterManager;
}
```

#### éƒ¨ç½²æ–¹å¼

```solidity
// æ­¥éª¤1: éƒ¨ç½² FiatToken ä»£ç†å’Œå®ç°åˆçº¦
FiatTokenProxy proxy = new FiatTokenProxy(fiatTokenImplementation);

// æ­¥éª¤2: éƒ¨ç½² MasterMinterï¼ŒæŒ‡å‘ FiatToken ä»£ç†
MasterMinter masterMinter = new MasterMinter(address(proxy));

// æ­¥éª¤3: åœ¨ FiatToken ä¸­è®¾ç½® MasterMinter
proxy.updateMasterMinter(address(masterMinter));
```

#### èŒè´£èŒƒå›´

- ğŸŒ **å…¨å±€é“¸å¸ç­–ç•¥ç®¡ç†**: å†³å®šå“ªäº›æ§åˆ¶å™¨æœ‰æƒç®¡ç†é“¸å¸
- ğŸ”§ **æ§åˆ¶å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**: æ·»åŠ ã€æ›´æ–°ã€ç§»é™¤æ§åˆ¶å™¨
- ğŸ›ï¸ **æ¶æ„å±‚æ¬¡ç»´æŠ¤**: ç»´æŠ¤ Controller â†’ Minter çš„æ˜ å°„å…³ç³»
- ğŸ“Š **é›†ä¸­ç›‘æ§**: æä¾›ç»Ÿä¸€çš„æŸ¥è¯¢æ¥å£

#### å®é™…åº”ç”¨åœºæ™¯

| æ§åˆ¶å™¨ | ç®¡ç†çš„é“¸å¸è€… | ä¸šåŠ¡åœºæ™¯ | å…¸å‹é¢åº¦ |
|-------|------------|---------|---------|
| Controller-US | Minter-US | ç¾å›½å¸‚åœºæ—¥å¸¸é“¸å¸ | 1000ä¸‡ USDC |
| Controller-EU | Minter-EU | æ¬§æ´²å¸‚åœºæ—¥å¸¸é“¸å¸ | 500ä¸‡ USDC |
| Controller-ASIA | Minter-ASIA | äºšå¤ªå¸‚åœºæ—¥å¸¸é“¸å¸ | 300ä¸‡ USDC |
| Controller-Emergency | Minter-Backup | ç´§æ€¥æƒ…å†µå¤‡ç”¨ | 100ä¸‡ USDC |
| Controller-Institutional | Minter-Institution | æœºæ„å¤§é¢é“¸å¸ | 5000ä¸‡ USDC |

---

### ğŸ”· Layer 2: Controllers - æ§åˆ¶å™¨å±‚

#### è®¾è®¡ç‰¹ç‚¹

- **ä¸€å¯¹ä¸€æ˜ å°„**: ä¸€ä¸ª Controller ç®¡ç†ä¸€ä¸ª Minter
- **å¯å¤ç”¨**: åŒä¸€ä¸ª Minter å¯ä»¥è¢«å¤šä¸ª Controllers ç®¡ç†ï¼ˆç¾å¤‡ï¼‰
- **ç‹¬ç«‹è¿ä½œ**: ä¸åŒ Controllers ä¹‹é—´äº’ä¸å¹²æ‰°

#### æ ¸å¿ƒåŠŸèƒ½

##### 1. é…ç½®é“¸å¸é¢åº¦

```solidity
/**
 * @notice ä¸ºé“¸å¸è€…è®¾ç½®é“¸å¸é¢åº¦
 * @param _newAllowance æ–°çš„é“¸å¸é¢åº¦
 */
function configureMinter(uint256 _newAllowance)
    public
    onlyController
    returns (bool)
{
    address minter = controllers[msg.sender];  // è·å–è‡ªå·±ç®¡ç†çš„é“¸å¸è€…
    emit MinterConfigured(msg.sender, minter, _newAllowance);
    return internal_setMinterAllowance(minter, _newAllowance);
}

// å†…éƒ¨å®ç°
function internal_setMinterAllowance(address _minter, uint256 _newAllowance)
    internal
    returns (bool)
{
    // è°ƒç”¨ FiatToken çš„ configureMinter
    return minterManager.configureMinter(_minter, _newAllowance);
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```solidity
// ç¾å›½æ§åˆ¶å™¨è®¾ç½®é“¸å¸é¢åº¦ä¸º 1000ä¸‡ USDC
controller_US.configureMinter(10_000_000e6);

// FiatToken ä¸­çš„çŠ¶æ€:
// minters[0xMinter_US] = true
// minterAllowed[0xMinter_US] = 10,000,000 USDC
```

##### 2. å¢åŠ é“¸å¸é¢åº¦

```solidity
/**
 * @notice å¢åŠ é“¸å¸è€…çš„é“¸å¸é¢åº¦
 * @param _allowanceIncrement è¦å¢åŠ çš„é¢åº¦
 */
function incrementMinterAllowance(uint256 _allowanceIncrement)
    public
    onlyController
    returns (bool)
{
    require(
        _allowanceIncrement > 0,
        "Allowance increment must be greater than 0"
    );

    address minter = controllers[msg.sender];
    require(
        minterManager.isMinter(minter),
        "Can only increment allowance for minters in minterManager"
    );

    uint256 currentAllowance = minterManager.minterAllowance(minter);
    uint256 newAllowance = currentAllowance.add(_allowanceIncrement);

    emit MinterAllowanceIncremented(
        msg.sender,
        minter,
        _allowanceIncrement,
        newAllowance
    );

    return internal_setMinterAllowance(minter, newAllowance);
}
```

**ä½¿ç”¨åœºæ™¯**:
```solidity
// åœºæ™¯: ç¾å›½å¸‚åœºéœ€æ±‚æ¿€å¢ï¼Œéœ€è¦æ›´å¤šé“¸å¸é¢åº¦

// å½“å‰é¢åº¦: 10,000,000 USDC
// å·²ä½¿ç”¨: 8,000,000 USDC
// å‰©ä½™: 2,000,000 USDC

// Controller å¢åŠ é¢åº¦ï¼ˆæ— éœ€ Owner å‚ä¸ï¼‰
controller_US.incrementMinterAllowance(5_000_000e6);  // å¢åŠ  500ä¸‡

// æ–°çŠ¶æ€:
// æ€»é¢åº¦: 15,000,000 USDC
// å·²ä½¿ç”¨: 8,000,000 USDC
// å‰©ä½™: 7,000,000 USDC
```

##### 3. å‡å°‘é“¸å¸é¢åº¦

```solidity
/**
 * @notice å‡å°‘é“¸å¸è€…çš„é“¸å¸é¢åº¦
 * @param _allowanceDecrement è¦å‡å°‘çš„é¢åº¦
 */
function decrementMinterAllowance(uint256 _allowanceDecrement)
    public
    onlyController
    returns (bool)
{
    require(
        _allowanceDecrement > 0,
        "Allowance decrement must be greater than 0"
    );

    address minter = controllers[msg.sender];
    require(
        minterManager.isMinter(minter),
        "Can only decrement allowance for minters in minterManager"
    );

    uint256 currentAllowance = minterManager.minterAllowance(minter);
    // å®é™…å‡å°‘é‡ä¸è¶…è¿‡å½“å‰é¢åº¦
    uint256 actualAllowanceDecrement = (
        currentAllowance > _allowanceDecrement
            ? _allowanceDecrement
            : currentAllowance
    );
    uint256 newAllowance = currentAllowance.sub(actualAllowanceDecrement);

    emit MinterAllowanceDecremented(
        msg.sender,
        minter,
        actualAllowanceDecrement,
        newAllowance
    );

    return internal_setMinterAllowance(minter, newAllowance);
}
```

##### 4. ç§»é™¤é“¸å¸è€…

```solidity
/**
 * @notice ç§»é™¤æ§åˆ¶å™¨ç®¡ç†çš„é“¸å¸è€…
 */
function removeMinter() public onlyController returns (bool) {
    address minter = controllers[msg.sender];
    emit MinterRemoved(msg.sender, minter);
    return minterManager.removeMinter(minter);
}
```

#### æƒé™éªŒè¯

```solidity
/**
 * @notice ä¿®é¥°ç¬¦ï¼šç¡®ä¿è°ƒç”¨è€…æ˜¯æœ‰æ•ˆçš„æ§åˆ¶å™¨
 */
modifier onlyController() {
    require(
        controllers[msg.sender] != address(0),
        "The value of controllers[msg.sender] must be non-zero"
    );
    _;
}
```

#### èŒè´£èŒƒå›´

- ğŸ“ **åœ°åŒº/ä¸šåŠ¡çº¿ç®¡ç†**: è´Ÿè´£ç‰¹å®šåŒºåŸŸæˆ–ä¸šåŠ¡çš„é“¸å¸ç®¡ç†
- ğŸ’° **åŠ¨æ€é¢åº¦è°ƒæ•´**: æ ¹æ®å¸‚åœºéœ€æ±‚å¿«é€Ÿè°ƒæ•´é“¸å¸é¢åº¦
- âš¡ **å¿«é€Ÿå“åº”**: æ— éœ€ Owner å‚ä¸ï¼Œæé«˜è¿è¥æ•ˆç‡
- ğŸ”§ **æ—¥å¸¸è¿è¥**: å¤„ç†æ—¥å¸¸é“¸å¸éœ€æ±‚

---

### ğŸ”· Layer 3: Minters - é“¸å¸è€…å±‚

#### è§’è‰²å®šä½
å®é™…æ‰§è¡Œé“¸å¸å’Œé”€æ¯æ“ä½œçš„åœ°å€ï¼Œç›´æ¥ä¸ FiatToken åˆçº¦äº¤äº’ã€‚

#### æ ¸å¿ƒåŠŸèƒ½

##### 1. é“¸é€ ä»£å¸

```solidity
/**
 * @notice é“¸é€ æ–°çš„ä»£å¸åˆ°æŒ‡å®šåœ°å€
 * @param _to æ¥æ”¶åœ°å€
 * @param _amount é“¸é€ æ•°é‡
 */
function mint(address _to, uint256 _amount)
    external
    whenNotPaused
    onlyMinters
    notBlacklisted(msg.sender)
    notBlacklisted(_to)
    returns (bool)
{
    require(_to != address(0), "FiatToken: mint to the zero address");
    require(_amount > 0, "FiatToken: mint amount not greater than 0");

    // æ£€æŸ¥é“¸å¸é¢åº¦
    uint256 mintingAllowedAmount = minterAllowed[msg.sender];
    require(
        _amount <= mintingAllowedAmount,
        "FiatToken: mint amount exceeds minterAllowance"
    );

    // æ‰§è¡Œé“¸å¸
    totalSupply_ = totalSupply_.add(_amount);
    _setBalance(_to, _balanceOf(_to).add(_amount));

    // å‡å°‘é“¸å¸é¢åº¦
    minterAllowed[msg.sender] = mintingAllowedAmount.sub(_amount);

    emit Mint(msg.sender, _to, _amount);
    emit Transfer(address(0), _to, _amount);
    return true;
}
```

**é“¸å¸æµç¨‹**:
```
ç”¨æˆ·è¯·æ±‚ â†’ Minter éªŒè¯ â†’ æ£€æŸ¥é¢åº¦ â†’ å¢åŠ æ€»ä¾›åº”é‡ â†’ å¢åŠ ç”¨æˆ·ä½™é¢ â†’ å‡å°‘é“¸å¸é¢åº¦ â†’ å‘å‡ºäº‹ä»¶
```

##### 2. é”€æ¯ä»£å¸

```solidity
/**
 * @notice é“¸å¸è€…é”€æ¯è‡ªå·±çš„ä»£å¸
 * @param _amount é”€æ¯æ•°é‡
 */
function burn(uint256 _amount)
    external
    whenNotPaused
    onlyMinters
    notBlacklisted(msg.sender)
{
    uint256 balance = _balanceOf(msg.sender);
    require(_amount > 0, "FiatToken: burn amount not greater than 0");
    require(balance >= _amount, "FiatToken: burn amount exceeds balance");

    // æ‰§è¡Œé”€æ¯
    totalSupply_ = totalSupply_.sub(_amount);
    _setBalance(msg.sender, balance.sub(_amount));

    emit Burn(msg.sender, _amount);
    emit Transfer(msg.sender, address(0), _amount);
}
```

**é”€æ¯æµç¨‹**:
```
ç”¨æˆ·èµå›æ³•å¸ â†’ Minter æ¥æ”¶ USDC â†’ éªŒè¯ä½™é¢ â†’ å‡å°‘æ€»ä¾›åº”é‡ â†’ å‡å°‘è‡ªå·±ä½™é¢ â†’ å‘å‡ºäº‹ä»¶
```

##### 3. æŸ¥è¯¢åŠŸèƒ½

```solidity
// æŸ¥è¯¢é“¸å¸é¢åº¦
function minterAllowance(address minter) external view returns (uint256) {
    return minterAllowed[minter];
}

// æ£€æŸ¥æ˜¯å¦æ˜¯é“¸å¸è€…
function isMinter(address account) external view returns (bool) {
    return minters[account];
}
```

#### Minter ç±»å‹å’Œç”¨é€”

| Minter ç±»å‹ | ç‰¹ç‚¹ | å…¸å‹é¢åº¦ | ä½¿ç”¨åœºæ™¯ |
|-----------|------|---------|---------|
| **çƒ­é’±åŒ… Minter** | åœ¨çº¿ã€å¿«é€Ÿå“åº” | 500ä¸‡ | æ—¥å¸¸é«˜é¢‘å°é¢é“¸å¸ |
| **è‡ªåŠ¨åŒ– Minter** | API é›†æˆ | 1000ä¸‡ | è‡ªåŠ¨åŒ–ä¸šåŠ¡æµç¨‹ |
| **æœºæ„ Minter** | å¤§é¢ä¸“ç”¨ | 5000ä¸‡ | æœºæ„å®¢æˆ·å¤§é¢é“¸å¸ |
| **å¤‡ç”¨ Minter** | ç¾å¤‡ä½¿ç”¨ | 100ä¸‡ | ä¸» Minter æ•…éšœæ—¶å¯ç”¨ |

#### é¢åº¦æ¶ˆè€—æœºåˆ¶

```solidity
// åœºæ™¯: Minter é“¸å¸é¢åº¦æ¶ˆè€—ç¤ºä¾‹

// åˆå§‹çŠ¶æ€
minterAllowed[minter_US] = 10_000_000e6;  // 1000ä¸‡ USDC

// ç¬¬1æ¬¡é“¸å¸: é“¸é€  100ä¸‡
minter_US.mint(user1, 1_000_000e6);
// å‰©ä½™é¢åº¦: 9,000,000 USDC

// ç¬¬2æ¬¡é“¸å¸: é“¸é€  500ä¸‡
minter_US.mint(user2, 5_000_000e6);
// å‰©ä½™é¢åº¦: 4,000,000 USDC

// ç¬¬3æ¬¡é“¸å¸: å°è¯•é“¸é€  500ä¸‡ï¼ˆè¶…è¿‡å‰©ä½™é¢åº¦ï¼‰
minter_US.mint(user3, 5_000_000e6);
// âŒ å¤±è´¥: "FiatToken: mint amount exceeds minterAllowance"

// Controller å¢åŠ é¢åº¦
controller_US.incrementMinterAllowance(6_000_000e6);
// æ–°é¢åº¦: 10,000,000 USDC

// ç°åœ¨å¯ä»¥ç»§ç»­é“¸å¸
minter_US.mint(user3, 5_000_000e6);
// âœ… æˆåŠŸ
// å‰©ä½™é¢åº¦: 5,000,000 USDC
```

#### èŒè´£èŒƒå›´

- ğŸ”¨ **æ‰§è¡Œé“¸å¸**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚é“¸é€ æ–°çš„ USDC
- ğŸ”¥ **æ‰§è¡Œé”€æ¯**: ç”¨æˆ·èµå›æ³•å¸æ—¶é”€æ¯ USDC
- ğŸ“Š **é¢åº¦ç®¡ç†**: ç›‘æ§è‡ªå·±çš„é“¸å¸é¢åº¦ï¼ŒåŠæ—¶å‘ Controller ç”³è¯·å¢åŠ 
- ğŸ’¼ **ä¸šåŠ¡å¯¹æ¥**: ä¸å®é™…ä¸šåŠ¡ç³»ç»Ÿï¼ˆå¦‚ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿï¼‰é›†æˆ

---

## è®¾è®¡ç›®çš„å’Œä¼˜åŠ¿

### 1. ğŸ” æƒé™åˆ†ç¦» (Separation of Concerns)

#### åŸç†
```
Owner (æˆ˜ç•¥å†³ç­–)
  â†“ è®¾ç½®ç­–ç•¥
MasterMinter (ç­–ç•¥æ‰§è¡Œ)
  â†“ åˆ†é…æƒé™
Controllers (åŒºåŸŸç®¡ç†)
  â†“ æ—¥å¸¸è¿è¥
Minters (å®é™…æ“ä½œ)
```

#### ä¼˜åŠ¿
- âœ… **é™ä½å•ç‚¹é£é™©**: æ¯å±‚åªæœ‰å¿…è¦çš„æƒé™
- âœ… **æé«˜å®‰å…¨æ€§**: Owner å†·é’±åŒ…å­˜å‚¨ï¼Œæ—¥å¸¸ä¸ä½¿ç”¨
- âœ… **é™åˆ¶æ”»å‡»é¢**: å³ä½¿æŸå±‚è¢«æ”»ç ´ï¼ŒæŸå¤±ä¹Ÿè¢«é™åˆ¶åœ¨è¯¥å±‚

#### å¯¹æ¯”å•å±‚æ¶æ„

| åœºæ™¯ | å•å±‚æ¶æ„ | å››å±‚æ¶æ„ |
|-----|---------|---------|
| Owner ç§é’¥æ³„éœ² | ğŸ’€ ç¾éš¾æ€§åæœ | ğŸ›¡ï¸ å¯ä»¥å¿«é€Ÿå†»ç»“/è½¬ç§» |
| Minter è¢«æ”»é™· | ğŸ’€ æ— é™é“¸å¸é£é™© | ğŸ›¡ï¸ å—é¢åº¦é™åˆ¶ |
| æ—¥å¸¸è¿è¥ | ğŸ”´ éœ€è¦ Owner é¢‘ç¹ç­¾å | ğŸŸ¢ Controller ç‹¬ç«‹å¤„ç† |
| å®‰å…¨å®¡è®¡ | ğŸ”´ æƒé™è¿‡äºé›†ä¸­ | ğŸŸ¢ èŒè´£æ¸…æ™°ï¼Œæ˜“äºå®¡è®¡ |

### 2. ğŸš€ çµæ´»æ‰©å±•æ€§ (Scalability)

#### è½»æ¾æ·»åŠ æ–°åœ°åŒº

```solidity
// æ— éœ€ä¿®æ”¹åˆçº¦ä»£ç ï¼Œåªéœ€é…ç½®

// æ·»åŠ å—ç¾åœ°åŒº
masterMinter.configureController(
    0xController_SouthAmerica,
    0xMinter_SouthAmerica
);

// æ·»åŠ éæ´²åœ°åŒº
masterMinter.configureController(
    0xController_Africa,
    0xMinter_Africa
);

// å·²æœ‰åœ°åŒºä¸å—å½±å“ï¼Œç»§ç»­æ­£å¸¸è¿è¥
```

#### æ”¯æŒå¤šä¸šåŠ¡çº¿

```solidity
// åŒä¸€åœ°åŒºå¯ä»¥æœ‰å¤šä¸ªä¸šåŠ¡çº¿

// é›¶å”®ä¸šåŠ¡
masterMinter.configureController(
    0xController_US_Retail,
    0xMinter_US_Retail
);

// æœºæ„ä¸šåŠ¡
masterMinter.configureController(
    0xController_US_Institutional,
    0xMinter_US_Institutional
);

// äº¤æ˜“æ‰€ä¸šåŠ¡
masterMinter.configureController(
    0xController_US_Exchange,
    0xMinter_US_Exchange
);
```

### 3. ğŸ’° é¢åº¦æ§åˆ¶ (Allowance Control)

#### ç±»ä¼¼ ERC20 çš„ Allowance æœºåˆ¶

```
ERC20 Allowance:
  ç”¨æˆ· â†’ æˆæƒ Spender ä¸€å®šé¢åº¦

Minter Allowance:
  Controller â†’ æˆæƒ Minter ä¸€å®šé“¸å¸é¢åº¦
```

#### é£é™©éš”ç¦»

```solidity
// åœºæ™¯: ä¸åŒé£é™©ç­‰çº§çš„ Minter

// é«˜é£é™©ï¼ˆçƒ­é’±åŒ…ï¼Œè‡ªåŠ¨åŒ–ï¼‰
controller_Auto.configureMinter(1_000_000e6);  // 100ä¸‡é™é¢

// ä¸­é£é™©ï¼ˆäººå·¥å®¡æ ¸ï¼‰
controller_Manual.configureMinter(5_000_000e6);  // 500ä¸‡é™é¢

// ä½é£é™©ï¼ˆå†·é’±åŒ…ï¼Œå¤šç­¾ï¼‰
controller_Secure.configureMinter(50_000_000e6);  // 5000ä¸‡é™é¢
```

#### åŠ¨æ€è°ƒæ•´

```solidity
// å¸‚åœºé«˜å³°æœŸ - å¢åŠ é¢åº¦
controller.incrementMinterAllowance(10_000_000e6);

// å¸‚åœºä½è°·æœŸ - å‡å°‘é¢åº¦
controller.decrementMinterAllowance(5_000_000e6);

// å®‰å…¨äº‹ä»¶ - ç«‹å³æ¸…é›¶
controller.configureMinter(0);
```

### 4. ğŸ›¡ï¸ ç¾å¤‡å’Œå®¹é”™ (Disaster Recovery)

#### åœºæ™¯ 1: Controller ç§é’¥æ³„éœ²

```solidity
// âš ï¸ å‘ç° Controller-US ç§é’¥æ³„éœ²

// ğŸš¨ Step 1: ç«‹å³ç§»é™¤è¯¥ Controllerï¼ˆOwner æ“ä½œï¼‰
masterMinter.removeController(0xController_US_Compromised);

// ğŸ”§ Step 2: é…ç½®æ–°çš„ Controller
masterMinter.configureController(
    0xController_US_New,
    0xMinter_US  // ä»ç„¶ä½¿ç”¨åŸæ¥çš„ Minter
);

// âš¡ Step 3: æ–° Controller è®¾ç½®é¢åº¦
controller_US_New.configureMinter(5_000_000e6);

// â±ï¸ æ€»è€—æ—¶: < 10åˆ†é’Ÿ
// âœ… å…¶ä»–åœ°åŒºä¸å—å½±å“
```

#### åœºæ™¯ 2: Minter çƒ­é’±åŒ…è¢«ç›—

```solidity
// âš ï¸ å‘ç° Minter-EU çƒ­é’±åŒ…è¢«ç›—

// ğŸš¨ Step 1: Controller ç«‹å³ç§»é™¤è¯¥ Minter
controller_EU.removeMinter();

// ğŸ”§ Step 2: Owner é…ç½®æ–°çš„ Minter
masterMinter.configureController(
    0xController_EU,
    0xMinter_EU_New  // æ–°çš„ Minter åœ°å€
);

// âš¡ Step 3: Controller é‡æ–°è®¾ç½®é¢åº¦
controller_EU.configureMinter(3_000_000e6);

// ğŸ’° æŸå¤±: ä»…é™äºè¢«ç›— Minter çš„å‰©ä½™é¢åº¦
// âœ… æ€»ä¾›åº”é‡ä¸å—å½±å“ï¼ˆMinter æ— æ³•å‡­ç©ºé“¸å¸ï¼‰
```

#### åœºæ™¯ 3: åŒæ§åˆ¶å™¨å¤‡ä»½

```solidity
// ğŸ” å…³é”® Minter é…ç½®åŒæ§åˆ¶å™¨

// ä¸»æ§åˆ¶å™¨
masterMinter.configureController(
    0xController_Primary,
    0xMinter_Critical
);

// å¤‡ç”¨æ§åˆ¶å™¨ï¼ˆç®¡ç†åŒä¸€ä¸ª Minterï¼‰
masterMinter.configureController(
    0xController_Backup,
    0xMinter_Critical
);

// âš ï¸ å¦‚æœä¸»æ§åˆ¶å™¨å¤±è´¥
if (primary_controller_fails) {
    // âœ… å¤‡ç”¨æ§åˆ¶å™¨ç«‹å³æ¥ç®¡
    controller_Backup.configureMinter(10_000_000e6);
}
```

### 5. ğŸ“Š å®¡è®¡å’Œåˆè§„ (Audit & Compliance)

#### å®Œæ•´çš„äº‹ä»¶æ—¥å¿—é“¾

```solidity
// é“¸å¸æ“ä½œçš„å®Œæ•´å®¡è®¡è¿½è¸ª

// Level 0: Owner è®¾ç½® MasterMinter
emit MasterMinterChanged(newMasterMinter);

// Level 1: MasterMinter é…ç½® Controller
emit ControllerConfigured(controller, minter);

// Level 2: Controller è®¾ç½®é“¸å¸é¢åº¦
emit MinterConfigured(controller, minter, allowance);

// Level 3: Minter æ‰§è¡Œé“¸å¸
emit Mint(minter, recipient, amount);
emit Transfer(address(0), recipient, amount);
```

#### å®¡è®¡æŸ¥è¯¢ç¤ºä¾‹

```javascript
// æŸ¥è¯¢æŸä¸ª Minter çš„å®Œæ•´å†å²

// 1. è°é…ç½®äº†è¿™ä¸ª Minterï¼Ÿ
const configEvents = await masterMinter.getPastEvents('ControllerConfigured', {
    filter: { _worker: minterAddress }
});

// 2. è¿™ä¸ª Minter è¢«è®¾ç½®è¿‡å“ªäº›é¢åº¦ï¼Ÿ
const allowanceEvents = await masterMinter.getPastEvents('MinterConfigured', {
    filter: { _minter: minterAddress }
});

// 3. è¿™ä¸ª Minter é“¸é€ äº†å¤šå°‘ USDCï¼Ÿ
const mintEvents = await fiatToken.getPastEvents('Mint', {
    filter: { minter: minterAddress }
});

// 4. è®¡ç®—æ€»é“¸å¸é‡
const totalMinted = mintEvents.reduce((sum, e) =>
    sum + BigInt(e.returnValues.amount), 0n
);
```

### 6. ğŸŒ å…¨çƒåŒ–è¿è¥æ”¯æŒ

#### å¤šåœ°åŒºç‹¬ç«‹ç®¡ç†

```
åŒ—ç¾åœ°åŒº:
  Controller-NA â†’ Minter-NA-1, Minter-NA-2

æ¬§æ´²åœ°åŒº:
  Controller-EU â†’ Minter-EU-1, Minter-EU-2

äºšå¤ªåœ°åŒº:
  Controller-APAC â†’ Minter-APAC-1, Minter-APAC-2

æ‹‰ç¾åœ°åŒº:
  Controller-LATAM â†’ Minter-LATAM-1
```

#### æ—¶åŒºå‹å¥½

```
ä¸åŒåœ°åŒºå¯ä»¥åœ¨è‡ªå·±çš„å·¥ä½œæ—¶é—´ç‹¬ç«‹æ“ä½œï¼Œ
æ— éœ€ç­‰å¾… Ownerï¼ˆå¯èƒ½åœ¨ä¸åŒæ—¶åŒºï¼‰çš„æ‰¹å‡†
```

#### åˆè§„è¦æ±‚

```
ä¸åŒåœ°åŒºå¯èƒ½æœ‰ä¸åŒçš„åˆè§„è¦æ±‚:
- ç¾å›½: SEC ç›‘ç®¡
- æ¬§æ´²: MiCA æ³•è§„
- äºšæ´²: å„å›½ç›‘ç®¡

æ¯ä¸ªåœ°åŒºçš„ Controller å¯ä»¥æ ¹æ®æœ¬åœ°è¦æ±‚
ç‹¬ç«‹ç®¡ç†é“¸å¸æµç¨‹
```

---

## å®é™…æ“ä½œæµç¨‹

### åœºæ™¯ 1: æ–°å¢ä¸€ä¸ªåœ°åŒºçš„é“¸å¸èƒ½åŠ›

#### èƒŒæ™¯
Circle å‡†å¤‡åœ¨æ—¥æœ¬å¸‚åœºæ¨å‡º USDCï¼Œéœ€è¦é…ç½®æ—¥æœ¬åœ°åŒºçš„é“¸å¸èƒ½åŠ›ã€‚

#### æ“ä½œæ­¥éª¤

```solidity
// ========== å‡†å¤‡é˜¶æ®µ ==========

// 1. ç”Ÿæˆæ–°çš„åœ°å€
address controller_Japan = 0x...;  // æ—¥æœ¬åœ°åŒºæ§åˆ¶å™¨ï¼ˆå¤šç­¾ï¼‰
address minter_Japan = 0x...;      // æ—¥æœ¬åœ°åŒºé“¸å¸è€…ï¼ˆçƒ­é’±åŒ…ï¼‰

// ========== é…ç½®é˜¶æ®µ ==========

// 2. Owner åœ¨ MasterMinter ä¸­é…ç½®æ–°æ§åˆ¶å™¨
// æ“ä½œè€…: Ownerï¼ˆå†·é’±åŒ…å¤šç­¾ï¼‰
// é“¾ä¸Šæ“ä½œ
masterMinter.configureController(
    controller_Japan,
    minter_Japan
);
// äº‹ä»¶: ControllerConfigured(controller_Japan, minter_Japan)

// ========== æˆæƒé˜¶æ®µ ==========

// 3. æ—¥æœ¬æ§åˆ¶å™¨è®¾ç½®åˆå§‹é“¸å¸é¢åº¦
// æ“ä½œè€…: Controller-Japan
// é¢åº¦: 300ä¸‡ USDCï¼ˆåˆæœŸå¸‚åœºï¼‰
controller_Japan.configureMinter(3_000_000e6);
// äº‹ä»¶: MinterConfigured(controller_Japan, minter_Japan, 3000000e6)

// ========== è¿è¥é˜¶æ®µ ==========

// 4. æ—¥æœ¬é“¸å¸è€…å¼€å§‹é“¸å¸
// æ“ä½œè€…: Minter-Japan
// ç”¨æˆ·è¯·æ±‚: ç”¨æˆ·è´­ä¹° 10,000 USDC
minter_Japan.mint(user_Japan, 10_000e6);
// äº‹ä»¶: Mint(minter_Japan, user_Japan, 10000e6)
//      Transfer(0x0, user_Japan, 10000e6)

// ========== çŠ¶æ€æŸ¥è¯¢ ==========

// 5. æŸ¥è¯¢å½“å‰çŠ¶æ€
masterMinter.getWorker(controller_Japan);
// è¿”å›: minter_Japan

fiatToken.isMinter(minter_Japan);
// è¿”å›: true

fiatToken.minterAllowance(minter_Japan);
// è¿”å›: 2,990,000 USDC (3,000,000 - 10,000)
```

#### æ—¶é—´ä¼°ç®—

| æ­¥éª¤ | æ“ä½œè€… | è€—æ—¶ | è¯´æ˜ |
|-----|--------|------|------|
| ç”Ÿæˆåœ°å€ | æŠ€æœ¯å›¢é˜Ÿ | 1å°æ—¶ | ç”Ÿæˆå¹¶æµ‹è¯•æ–°åœ°å€ |
| Owner é…ç½® | Owner å¤šç­¾ | 30åˆ†é’Ÿ | æ”¶é›†ç­¾åå¹¶æäº¤ |
| é“¾ä¸Šç¡®è®¤ | - | 2åˆ†é’Ÿ | ç­‰å¾…åŒºå—ç¡®è®¤ |
| Controller æˆæƒ | Controller | 5åˆ†é’Ÿ | è®¾ç½®é“¸å¸é¢åº¦ |
| å¼€å§‹è¿è¥ | Minter | å³æ—¶ | å¯ä»¥ç«‹å³é“¸å¸ |
| **æ€»è®¡** | - | **~2å°æ—¶** | ä»å†³ç­–åˆ°ä¸Šçº¿ |

---

### åœºæ™¯ 2: åŠ¨æ€è°ƒæ•´é“¸å¸é¢åº¦

#### èƒŒæ™¯
ç¾å›½å¸‚åœºéœ€æ±‚æ¿€å¢ï¼Œå½“å‰é“¸å¸é¢åº¦å³å°†ç”¨å®Œï¼Œéœ€è¦ç´§æ€¥å¢åŠ é¢åº¦ã€‚

#### æ“ä½œæ­¥éª¤

```solidity
// ========== å½“å‰çŠ¶æ€ ==========

// Minter-US çš„çŠ¶æ€
fiatToken.minterAllowance(minter_US);
// è¿”å›: 2,000,000 USDC (å‰©ä½™)

// å†å²é“¸å¸:
// åˆå§‹é¢åº¦: 10,000,000 USDC
// å·²ä½¿ç”¨: 8,000,000 USDC
// å‰©ä½™: 2,000,000 USDC

// ========== é—®é¢˜ ==========

// æ–°çš„é“¸å¸è¯·æ±‚: 5,000,000 USDC
// ä½†å‰©ä½™é¢åº¦åªæœ‰ 2,000,000 USDC
// éœ€è¦å¢åŠ é¢åº¦

// ========== è§£å†³æ–¹æ¡ˆ ==========

// æ–¹æ¡ˆ 1: å¢é‡æ·»åŠ ï¼ˆæ¨èï¼‰
// æ“ä½œè€…: Controller-US
// æ— éœ€ Owner å‚ä¸
controller_US.incrementMinterAllowance(5_000_000e6);
// æ–°é¢åº¦: 7,000,000 USDC (2,000,000 + 5,000,000)
// äº‹ä»¶: MinterAllowanceIncremented(controller_US, minter_US, 5000000e6, 7000000e6)

// æ–¹æ¡ˆ 2: é‡æ–°è®¾ç½®æ€»é¢åº¦
controller_US.configureMinter(15_000_000e6);
// æ–°é¢åº¦: 15,000,000 USDC
// äº‹ä»¶: MinterConfigured(controller_US, minter_US, 15000000e6)

// ========== æ‰§è¡Œé“¸å¸ ==========

// ç°åœ¨å¯ä»¥æ»¡è¶³é“¸å¸éœ€æ±‚
minter_US.mint(institution, 5_000_000e6);
// âœ… æˆåŠŸ
// å‰©ä½™é¢åº¦: 2,000,000 USDC (7,000,000 - 5,000,000)
```

#### å¯¹æ¯”ï¼šéœ€è¦ Owner vs ä¸éœ€è¦ Owner

| åœºæ™¯ | æ˜¯å¦éœ€è¦ Owner | å“åº”æ—¶é—´ |
|-----|---------------|---------|
| å¢åŠ é“¸å¸é¢åº¦ | âŒ ä¸éœ€è¦ | ~5åˆ†é’Ÿ |
| å‡å°‘é“¸å¸é¢åº¦ | âŒ ä¸éœ€è¦ | ~5åˆ†é’Ÿ |
| ç§»é™¤é“¸å¸è€… | âŒ ä¸éœ€è¦ | ~5åˆ†é’Ÿ |
| é…ç½®æ–°æ§åˆ¶å™¨ | âœ… éœ€è¦ | ~30åˆ†é’Ÿ |
| ç§»é™¤æ§åˆ¶å™¨ | âœ… éœ€è¦ | ~30åˆ†é’Ÿ |
| æ›´æ¢ MasterMinter | âœ… éœ€è¦ | ~30åˆ†é’Ÿ |

---

### åœºæ™¯ 3: ç´§æ€¥å“åº” - Controller è¢«æ”»é™·

#### èƒŒæ™¯
å®‰å…¨å›¢é˜Ÿå‘ç° Controller-EU çš„ç§é’¥å¯èƒ½å·²æ³„éœ²ï¼Œéœ€è¦ç«‹å³å“åº”ã€‚

#### åº”æ€¥é¢„æ¡ˆ

```solidity
// ========== T+0åˆ†é’Ÿ: å‘ç°å®‰å…¨äº‹ä»¶ ==========

// ğŸš¨ å®‰å…¨å‘Šè­¦
SecurityAlert: "Controller-EU private key may be compromised"
RiskLevel: CRITICAL
Action: IMMEDIATE

// ========== T+2åˆ†é’Ÿ: è¯„ä¼°å½±å“ ==========

// æŸ¥è¯¢å—å½±å“çš„ Minter
address compromisedMinter = masterMinter.getWorker(controller_EU);
// è¿”å›: minter_EU

// æŸ¥è¯¢è¯¥ Minter çš„å½“å‰é¢åº¦
uint256 currentAllowance = fiatToken.minterAllowance(minter_EU);
// è¿”å›: 3,500,000 USDC

// æœ€å¤§æ½œåœ¨æŸå¤±: 350ä¸‡ USDC

// ========== T+5åˆ†é’Ÿ: å¯åŠ¨åº”æ€¥å“åº” ==========

// Step 1: Owner ç«‹å³ç§»é™¤è¢«æ”»é™·çš„ Controller
// æ“ä½œè€…: Ownerï¼ˆå†·é’±åŒ…å¤šç­¾ - ç´§æ€¥å“åº”æ¨¡å¼ï¼‰
masterMinter.removeController(controller_EU_Compromised);
// äº‹ä»¶: ControllerRemoved(controller_EU_Compromised)
// âœ… æ”»å‡»è€…çš„æ§åˆ¶å™¨å·²å¤±æ•ˆï¼Œæ— æ³•å†æ“ä½œ

// Step 2: æ£€æŸ¥ Minter æ˜¯å¦ä»ç„¶å®‰å…¨
bool isMinterSafe = checkMinterSecurity(minter_EU);

if (isMinterSafe) {
    // åœºæ™¯ A: Minter å®‰å…¨ï¼Œåªæ˜¯ Controller è¢«æ”»é™·

    // é…ç½®æ–°çš„å¤‡ç”¨ Controller
    masterMinter.configureController(
        controller_EU_Backup,  // ä½¿ç”¨é¢„å…ˆå‡†å¤‡çš„å¤‡ç”¨æ§åˆ¶å™¨
        minter_EU              // ä»ç„¶ä½¿ç”¨åŸ Minter
    );

    // æ–° Controller é‡æ–°è®¾ç½®é¢åº¦ï¼ˆä¿å®ˆç­–ç•¥ï¼‰
    controller_EU_Backup.configureMinter(1_000_000e6);
    // é™ä½åˆå§‹é¢åº¦ï¼Œé€æ­¥æ¢å¤

} else {
    // åœºæ™¯ B: Minter ä¹Ÿå¯èƒ½è¢«æ”»é™·

    // ç§»é™¤æ—§ Minter
    controller_EU_Backup.removeMinter();

    // é…ç½®å…¨æ–°çš„ Controller å’Œ Minter
    masterMinter.configureController(
        controller_EU_New,
        minter_EU_New  // å…¨æ–°çš„ Minter
    );

    controller_EU_New.configureMinter(1_000_000e6);
}

// ========== T+10åˆ†é’Ÿ: æ¢å¤è¿è¥ ==========

// æ¬§æ´²åœ°åŒºé“¸å¸èƒ½åŠ›å·²æ¢å¤
minter_EU_New.mint(user, 100_000e6);
// âœ… æˆåŠŸ

// ========== T+1å°æ—¶: äº‹ååˆ†æ ==========

// 1. åˆ†ææ”»å‡»è€…æ˜¯å¦å·²ç»åˆ©ç”¨äº†è¢«æ”»é™·çš„ Controller
const suspiciousTransactions = await analyzeControllerTransactions(
    controller_EU_Compromised,
    lastKnownSafeTimestamp,
    currentTimestamp
);

// 2. å¦‚æœå‘ç°å¼‚å¸¸é“¸å¸ï¼Œå¯åŠ¨é»‘åå•æœºåˆ¶
if (suspiciousTransactions.length > 0) {
    for (const tx of suspiciousTransactions) {
        blacklister.blacklist(tx.recipient);
        // å†»ç»“è¢«éæ³•é“¸é€ çš„ä»£å¸
    }
}

// 3. æ›´æ–°å®‰å…¨ç­–ç•¥
updateSecurityPolicy({
    controller_rotation: '30 days',
    monitoring: 'enhanced',
    alert_threshold: 'lowered'
});
```

#### å“åº”æ—¶é—´çº¿

| æ—¶é—´ç‚¹ | æ“ä½œ | çŠ¶æ€ |
|-------|------|------|
| T+0 | å‘ç°å®‰å…¨äº‹ä»¶ | ğŸš¨ å‘Šè­¦ |
| T+2 | è¯„ä¼°å½±å“èŒƒå›´ | ğŸ“Š åˆ†æ |
| T+5 | Owner ç§»é™¤ Controller | ğŸ›¡ï¸ é£é™©éš”ç¦» |
| T+7 | é…ç½®å¤‡ç”¨ Controller | ğŸ”§ æ¢å¤å‡†å¤‡ |
| T+10 | æ¢å¤è¿è¥ | âœ… ä¸šåŠ¡æ­£å¸¸ |
| T+60 | äº‹ååˆ†æ | ğŸ“‹ æ€»ç»“æ”¹è¿› |

#### å…¶ä»–åœ°åŒºå½±å“

```
âœ… åŒ—ç¾åœ°åŒº: æ­£å¸¸è¿è¥ï¼ˆä¸å—å½±å“ï¼‰
âœ… äºšå¤ªåœ°åŒº: æ­£å¸¸è¿è¥ï¼ˆä¸å—å½±å“ï¼‰
âœ… æ‹‰ç¾åœ°åŒº: æ­£å¸¸è¿è¥ï¼ˆä¸å—å½±å“ï¼‰
ğŸ”§ æ¬§æ´²åœ°åŒº: 10åˆ†é’Ÿä¸­æ–­åæ¢å¤
```

---

### åœºæ™¯ 4: å¸‚åœºé«˜å³°æœŸçš„é¢åº¦ç®¡ç†

#### èƒŒæ™¯
åŠ å¯†è´§å¸å¸‚åœºæ³¢åŠ¨ï¼ŒUSDC éœ€æ±‚æ¿€å¢ï¼Œå¤šä¸ªåœ°åŒºåŒæ—¶éœ€è¦å¢åŠ é“¸å¸é¢åº¦ã€‚

#### åè°ƒæ–¹æ¡ˆ

```solidity
// ========== å¸‚åœºçŠ¶å†µ ==========

// å…¨çƒ USDC éœ€æ±‚æ¿€å¢
// åŸå› : BTC çªç ´æ–°é«˜ï¼Œç¨³å®šå¸éœ€æ±‚å¢åŠ 

// ========== å„åœ°åŒºå½“å‰çŠ¶æ€ ==========

// åŒ—ç¾åœ°åŒº
fiatToken.minterAllowance(minter_US);
// è¿”å›: 1,000,000 USDC (å‰©ä½™ï¼Œæ¥è¿‘ç”¨å®Œ)

// æ¬§æ´²åœ°åŒº
fiatToken.minterAllowance(minter_EU);
// è¿”å›: 500,000 USDC (å‰©ä½™ï¼Œæ¥è¿‘ç”¨å®Œ)

// äºšå¤ªåœ°åŒº
fiatToken.minterAllowance(minter_ASIA);
// è¿”å›: 300,000 USDC (å‰©ä½™ï¼Œæ¥è¿‘ç”¨å®Œ)

// ========== å¹¶è¡Œå¢åŠ é¢åº¦ ==========

// æ‰€æœ‰ Controllers å¯ä»¥åŒæ—¶ç‹¬ç«‹æ“ä½œ

// åŒ—ç¾åœ°åŒº Controller å¢åŠ é¢åº¦
controller_US.incrementMinterAllowance(20_000_000e6);
// æ–°å‰©ä½™: 21,000,000 USDC
// æ—¶é—´: 09:00 EST

// æ¬§æ´²åœ°åŒº Controller å¢åŠ é¢åº¦
controller_EU.incrementMinterAllowance(10_000_000e6);
// æ–°å‰©ä½™: 10,500,000 USDC
// æ—¶é—´: 14:00 GMT (åŒä¸€æ—¶åˆ»)

// äºšå¤ªåœ°åŒº Controller å¢åŠ é¢åº¦
controller_ASIA.incrementMinterAllowance(8_000_000e6);
// æ–°å‰©ä½™: 8,300,000 USDC
// æ—¶é—´: 22:00 CST (åŒä¸€æ—¶åˆ»)

// ========== ç›‘æ§æ€»ä¾›åº”é‡ ==========

// Circle çš„é£é™©ç®¡ç†å›¢é˜Ÿå®æ—¶ç›‘æ§
uint256 totalSupply = fiatToken.totalSupply();
// å®æ—¶è¿½è¸ªé“¸å¸é‡

// å¦‚æœæ€»ä¾›åº”é‡å¢é•¿è¿‡å¿«ï¼ŒOwner å¯ä»¥ä»‹å…¥
if (totalSupply > RISK_THRESHOLD) {
    // æš‚åœæ‰€æœ‰é“¸å¸ï¼ˆç´§æ€¥æƒ…å†µï¼‰
    pauser.pause();

    // æˆ–è€…ï¼šOwner æŒ‡ç¤ºå„ Controller é™ä½é¢åº¦
    // è¿™éœ€è¦ Owner ä¸å„åœ°åŒº Controller æ²Ÿé€š
}

// ========== å¸‚åœºç¨³å®šå ==========

// å„åœ°åŒºæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é¢åº¦

// åŒ—ç¾åœ°åŒºéœ€æ±‚ä¸‹é™ï¼Œå‡å°‘é¢åº¦
controller_US.decrementMinterAllowance(10_000_000e6);

// æ¬§æ´²åœ°åŒºä»æœ‰éœ€æ±‚ï¼Œä¿æŒé¢åº¦
// ï¼ˆæ— éœ€æ“ä½œï¼‰

// äºšå¤ªåœ°åŒºéœ€æ±‚ä¸‹é™
controller_ASIA.decrementMinterAllowance(5_000_000e6);
```

#### ä¼˜åŠ¿ä½“ç°

**ğŸŒ å…¨çƒåè°ƒ vs ä¸­å¿ƒåŒ–æ§åˆ¶**

| æ–¹é¢ | ä¸­å¿ƒåŒ–ï¼ˆå•å±‚ï¼‰ | åˆ†å±‚æ¶æ„ |
|-----|-------------|---------|
| å†³ç­–é€Ÿåº¦ | ğŸ”´ æ…¢ï¼ˆéœ€è¦å…¨çƒåè°ƒï¼‰ | ğŸŸ¢ å¿«ï¼ˆå„åœ°åŒºç‹¬ç«‹ï¼‰ |
| æ—¶åŒºé—®é¢˜ | ğŸ”´ ä¸¥é‡ï¼ˆOwner å¯èƒ½åœ¨ç¡è§‰ï¼‰ | ğŸŸ¢ æ— å½±å“ï¼ˆå„åœ°åŒºè‡ªæ²»ï¼‰ |
| å“åº”æ—¶é—´ | ğŸ”´ æ•°å°æ—¶ | ğŸŸ¢ æ•°åˆ†é’Ÿ |
| é£é™©æ§åˆ¶ | ğŸ”´ é›†ä¸­é£é™© | ğŸŸ¢ åˆ†æ•£é£é™© |
| è¿è¥æ•ˆç‡ | ğŸ”´ ä½ | ğŸŸ¢ é«˜ |

---

## ä»£ç å®ç°

### å®Œæ•´çš„åˆçº¦ä»£ç ç»“æ„

```
contracts/
â”œâ”€â”€ v1/
â”‚   â”œâ”€â”€ FiatTokenV1.sol          # ä¸»ä»£å¸åˆçº¦
â”‚   â”œâ”€â”€ Ownable.sol               # æ‰€æœ‰æƒç®¡ç†
â”‚   â”œâ”€â”€ Pausable.sol              # æš‚åœæœºåˆ¶
â”‚   â””â”€â”€ Blacklistable.sol         # é»‘åå•ç®¡ç†
â”‚
â”œâ”€â”€ minting/
â”‚   â”œâ”€â”€ Controller.sol            # åŸºç¡€æ§åˆ¶å™¨ï¼ˆLayer 2ï¼‰
â”‚   â”œâ”€â”€ MintController.sol        # é“¸å¸æ§åˆ¶å™¨ï¼ˆæ‰©å±• Controllerï¼‰
â”‚   â”œâ”€â”€ MasterMinter.sol          # ä¸»é“¸å¸ç®¡ç†å™¨ï¼ˆLayer 1ï¼‰
â”‚   â””â”€â”€ MinterManagementInterface.sol  # Minter ç®¡ç†æ¥å£
â”‚
â””â”€â”€ upgradeability/
    â”œâ”€â”€ Proxy.sol                 # åŸºç¡€ä»£ç†
    â”œâ”€â”€ UpgradeabilityProxy.sol   # å¯å‡çº§ä»£ç†
    â”œâ”€â”€ AdminUpgradeabilityProxy.sol  # å¸¦ç®¡ç†å‘˜çš„ä»£ç†
    â””â”€â”€ FiatTokenProxy.sol        # USDC ä»£ç†åˆçº¦
```

### å…³é”®æ¥å£

#### MinterManagementInterface

```solidity
/**
 * @title MinterManagementInterface
 * @notice FiatToken éœ€è¦å®ç°çš„é“¸å¸ç®¡ç†æ¥å£
 */
interface MinterManagementInterface {
    /**
     * @notice æ£€æŸ¥åœ°å€æ˜¯å¦æ˜¯é“¸å¸è€…
     */
    function isMinter(address _account) external view returns (bool);

    /**
     * @notice æŸ¥è¯¢é“¸å¸è€…çš„å‰©ä½™é¢åº¦
     */
    function minterAllowance(address _minter) external view returns (uint256);

    /**
     * @notice é…ç½®é“¸å¸è€…åŠå…¶é¢åº¦
     */
    function configureMinter(address _minter, uint256 _minterAllowedAmount)
        external
        returns (bool);

    /**
     * @notice ç§»é™¤é“¸å¸è€…
     */
    function removeMinter(address _minter) external returns (bool);
}
```

### éƒ¨ç½²è„šæœ¬

```solidity
// scripts/deploy/deploy-master-minter.s.sol

pragma solidity 0.6.12;

import "forge-std/Script.sol";
import { MasterMinter } from "../../contracts/minting/MasterMinter.sol";
import { FiatTokenProxy } from "../../contracts/v1/FiatTokenProxy.sol";

contract DeployMasterMinter is Script {
    function run() external {
        uint256 deployerPrivateKey = vm.envUint("DEPLOYER_PRIVATE_KEY");
        address fiatTokenProxy = vm.envAddress("FIAT_TOKEN_PROXY");

        vm.startBroadcast(deployerPrivateKey);

        // éƒ¨ç½² MasterMinter
        MasterMinter masterMinter = new MasterMinter(fiatTokenProxy);

        console.log("MasterMinter deployed at:", address(masterMinter));

        vm.stopBroadcast();

        // æ³¨æ„ï¼šéƒ¨ç½²åéœ€è¦åœ¨ FiatToken ä¸­è®¾ç½® MasterMinter
        // fiatToken.updateMasterMinter(address(masterMinter));
        // è¿™éœ€è¦ Owner æ‰§è¡Œ
    }
}
```

### åˆå§‹åŒ–è„šæœ¬

```solidity
// scripts/initialize-minting-system.s.sol

pragma solidity 0.6.12;

import "forge-std/Script.sol";
import { MasterMinter } from "../../contracts/minting/MasterMinter.sol";
import { FiatTokenV2_2 } from "../../contracts/v2/FiatTokenV2_2.sol";

contract InitializeMintingSystem is Script {
    function run() external {
        // ä»ç¯å¢ƒå˜é‡è¯»å–åœ°å€
        address owner = vm.envAddress("OWNER");
        address masterMinter = vm.envAddress("MASTER_MINTER");
        address fiatToken = vm.envAddress("FIAT_TOKEN");

        // æ§åˆ¶å™¨å’Œé“¸å¸è€…åœ°å€
        address controllerUS = vm.envAddress("CONTROLLER_US");
        address minterUS = vm.envAddress("MINTER_US");

        address controllerEU = vm.envAddress("CONTROLLER_EU");
        address minterEU = vm.envAddress("MINTER_EU");

        vm.startBroadcast(owner);

        // Step 1: åœ¨ FiatToken ä¸­è®¾ç½® MasterMinter
        FiatTokenV2_2(fiatToken).updateMasterMinter(masterMinter);
        console.log("MasterMinter set in FiatToken");

        // Step 2: é…ç½® Controllers
        MasterMinter(masterMinter).configureController(controllerUS, minterUS);
        console.log("Controller-US configured");

        MasterMinter(masterMinter).configureController(controllerEU, minterEU);
        console.log("Controller-EU configured");

        vm.stopBroadcast();

        // Step 3: å„ Controller éœ€è¦è®¾ç½®é“¸å¸é¢åº¦
        // è¿™éœ€è¦å„è‡ªçš„ Controller ç§é’¥æ‰§è¡Œ
        console.log("\nNext steps:");
        console.log("1. Controller-US should call configureMinter()");
        console.log("2. Controller-EU should call configureMinter()");
    }
}
```

---

## æœ€ä½³å®è·µ

### 1. ğŸ” å®‰å…¨æœ€ä½³å®è·µ

#### Owner ç®¡ç†

```
âœ… DO:
- ä½¿ç”¨å†·é’±åŒ…å­˜å‚¨ Owner ç§é’¥
- ä½¿ç”¨å¤šç­¾é’±åŒ…ï¼ˆå¦‚ Gnosis Safe 3/5ï¼‰
- å®šæœŸè½®æ¢å¤šç­¾æˆå‘˜
- æ‰€æœ‰ Owner æ“ä½œéœ€è¦å¤šäººå®¡æ‰¹
- è®°å½•æ‰€æœ‰ Owner æ“ä½œçš„å®¡æ‰¹æµç¨‹

âŒ DON'T:
- ä½¿ç”¨çƒ­é’±åŒ…å­˜å‚¨ Owner ç§é’¥
- å•ç­¾ Owner
- Owner ç§é’¥å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Š
- Owner é¢‘ç¹æ‰§è¡Œæ—¥å¸¸æ“ä½œ
- æ²¡æœ‰æ“ä½œå®¡è®¡æ—¥å¿—
```

#### Controller ç®¡ç†

```
âœ… DO:
- ä½¿ç”¨ç¡¬ä»¶é’±åŒ…æˆ–å¤šç­¾
- å®šæœŸè½®æ¢ Controller åœ°å€ï¼ˆå¦‚æ¯3ä¸ªæœˆï¼‰
- ä¸ºæ¯ä¸ª Controller è®¾ç½®æ“ä½œæ—¥å¿—
- ç›‘æ§ Controller çš„å¼‚å¸¸æ“ä½œ
- å»ºç«‹ Controller æƒé™å®¡è®¡æœºåˆ¶

âŒ DON'T:
- Controller ç§é’¥å­˜å‚¨åœ¨äº‘æœåŠ¡å™¨
- é•¿æœŸä¸æ›´æ¢ Controller
- æ²¡æœ‰ Controller æ“ä½œç›‘æ§
- å•ä¸ª Controller ç®¡ç†è¿‡å¤š Minters
```

#### Minter ç®¡ç†

```
âœ… DO:
- æ ¹æ®é£é™©ç­‰çº§è®¾ç½®ä¸åŒçš„é“¸å¸é¢åº¦
- é«˜é¢‘ Minter ä½¿ç”¨è¾ƒä½é¢åº¦
- å®æ—¶ç›‘æ§ Minter çš„é“¸å¸è¡Œä¸º
- å»ºç«‹ Minter é¢åº¦é¢„è­¦æœºåˆ¶
- å®šæœŸå®¡è®¡ Minter çš„é“¸å¸è®°å½•

âŒ DON'T:
- æ‰€æœ‰ Minter ä½¿ç”¨ç›¸åŒçš„é«˜é¢åº¦
- æ²¡æœ‰ Minter è¡Œä¸ºç›‘æ§
- Minter ç§é’¥ä¸ä¸šåŠ¡ç³»ç»Ÿå¼ºè€¦åˆ
- æ²¡æœ‰é¢åº¦é¢„è­¦å’Œé™åˆ¶
```

### 2. ğŸ“Š è¿è¥æœ€ä½³å®è·µ

#### é¢åº¦ç®¡ç†ç­–ç•¥

```javascript
// æ¨èçš„é¢åº¦åˆ†é…ç­–ç•¥

const mintingAllocationStrategy = {
    // æ—¥å¸¸è¿è¥ Minterï¼ˆ70%ï¼‰
    dailyOperations: {
        US: 10_000_000,      // 1000ä¸‡ USDC
        EU: 5_000_000,       // 500ä¸‡ USDC
        ASIA: 3_000_000,     // 300ä¸‡ USDC
    },

    // æœºæ„ä¸šåŠ¡ Minterï¼ˆ20%ï¼‰
    institutional: {
        largeClients: 20_000_000,  // 2000ä¸‡ USDC
    },

    // å¤‡ç”¨ Minterï¼ˆ10%ï¼‰
    backup: {
        emergency: 1_000_000,      // 100ä¸‡ USDC
        disaster: 5_000_000,       // 500ä¸‡ USDC
    }
};

// åŠ¨æ€è°ƒæ•´è§„åˆ™
const adjustmentRules = {
    // æ¯æ—¥æ£€æŸ¥
    dailyCheck: () => {
        for (const [minter, allowance] of minters) {
            if (allowance < THRESHOLD_LOW) {
                notifyController(minter, 'LOW_ALLOWANCE');
            }
            if (allowance > THRESHOLD_HIGH) {
                notifyController(minter, 'EXCESSIVE_ALLOWANCE');
            }
        }
    },

    // è‡ªåŠ¨å¢åŠ ï¼ˆå¸‚åœºé«˜å³°ï¼‰
    autoIncrease: (minter, marketCondition) => {
        if (marketCondition === 'HIGH_DEMAND') {
            const increment = calculateIncrement(marketCondition);
            controller.incrementMinterAllowance(increment);
        }
    },

    // è‡ªåŠ¨å‡å°‘ï¼ˆå¸‚åœºä½è°·ï¼‰
    autoDecrease: (minter, marketCondition) => {
        if (marketCondition === 'LOW_DEMAND') {
            const decrement = calculateDecrement(marketCondition);
            controller.decrementMinterAllowance(decrement);
        }
    }
};
```

#### ç›‘æ§å’Œå‘Šè­¦

```javascript
// æ¨èçš„ç›‘æ§æŒ‡æ ‡

const monitoringMetrics = {
    // å®æ—¶æŒ‡æ ‡
    realtime: {
        totalSupply: 'USDCæ€»ä¾›åº”é‡',
        mintingRate: 'æ¯å°æ—¶é“¸å¸é‡',
        burningRate: 'æ¯å°æ—¶é”€æ¯é‡',
        netIssuance: 'å‡€å‘è¡Œé‡',
    },

    // Minter æŒ‡æ ‡
    perMinter: {
        remainingAllowance: 'å‰©ä½™é“¸å¸é¢åº¦',
        utilizationRate: 'é¢åº¦ä½¿ç”¨ç‡',
        mintingFrequency: 'é“¸å¸é¢‘ç‡',
        averageMintSize: 'å¹³å‡é“¸å¸é‡‘é¢',
    },

    // å‘Šè­¦é˜ˆå€¼
    alerts: {
        allowanceLow: {
            threshold: 0.2,  // å‰©ä½™é¢åº¦ < 20%
            action: 'NOTIFY_CONTROLLER'
        },
        allowanceCritical: {
            threshold: 0.05,  // å‰©ä½™é¢åº¦ < 5%
            action: 'URGENT_NOTIFY'
        },
        unusualMinting: {
            threshold: 3.0,  // é“¸å¸é‡ > å¹³å‡å€¼çš„3å€
            action: 'SECURITY_REVIEW'
        },
        rapidDepletion: {
            threshold: 0.5,  // é¢åº¦åœ¨1å°æ—¶å†…æ¶ˆè€— > 50%
            action: 'IMMEDIATE_INVESTIGATION'
        }
    }
};

// å‘Šè­¦å¤„ç†æµç¨‹
const alertHandling = {
    NOTIFY_CONTROLLER: (minter) => {
        sendEmail(getController(minter), `Minter ${minter} allowance low`);
    },

    URGENT_NOTIFY: (minter) => {
        sendSMS(getController(minter), `URGENT: Minter ${minter} allowance critical`);
        sendSlack(securityChannel, `@here Minter ${minter} needs immediate attention`);
    },

    SECURITY_REVIEW: (minter) => {
        createTicket('SECURITY', `Unusual minting pattern for ${minter}`);
        pauseMinter(minter);  // å¯é€‰ï¼šè‡ªåŠ¨æš‚åœ
    },

    IMMEDIATE_INVESTIGATION: (minter) => {
        notifySecurityTeam(`CRITICAL: Rapid allowance depletion for ${minter}`);
        initiateIncidentResponse(minter);
    }
};
```

### 3. ğŸš¨ åº”æ€¥å“åº”æµç¨‹

#### æ ‡å‡†åº”æ€¥å“åº”æµç¨‹ï¼ˆSOPï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”æ€¥å“åº”å†³ç­–æ ‘                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Q1: å‘ç°ä»€ä¹ˆç±»å‹çš„å®‰å…¨äº‹ä»¶ï¼Ÿ

â”œâ”€ Controller è¢«æ”»é™·
â”‚  â”‚
â”‚  â”œâ”€ Owner ç«‹å³ç§»é™¤è¯¥ Controller
â”‚  â”œâ”€ è¯„ä¼° Minter æ˜¯å¦å®‰å…¨
â”‚  â”œâ”€ é…ç½®æ–°çš„ Controller
â”‚  â””â”€ é€æ­¥æ¢å¤é“¸å¸é¢åº¦
â”‚
â”œâ”€ Minter è¢«æ”»é™·
â”‚  â”‚
â”‚  â”œâ”€ Controller ç«‹å³ç§»é™¤è¯¥ Minter
â”‚  â”œâ”€ æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸é“¸å¸
â”‚  â”œâ”€ å¿…è¦æ—¶å¯ç”¨é»‘åå•
â”‚  â””â”€ é…ç½®æ–°çš„ Minter
â”‚
â”œâ”€ å¼‚å¸¸é“¸å¸è¡Œä¸º
â”‚  â”‚
â”‚  â”œâ”€ Pauser ç«‹å³æš‚åœåˆçº¦
â”‚  â”œâ”€ åˆ†æå¼‚å¸¸é“¸å¸çš„æ¥æº
â”‚  â”œâ”€ é»‘åå•ç›¸å…³åœ°å€
â”‚  â””â”€ ä¿®å¤åæ¢å¤è¿è¥
â”‚
â””â”€ Owner ç§é’¥æ³„éœ²
   â”‚
   â”œâ”€ ğŸš¨ ç´§æ€¥ï¼æœ€é«˜ä¼˜å…ˆçº§
   â”œâ”€ ç«‹å³é€šçŸ¥æ‰€æœ‰åˆ©ç›Šç›¸å…³æ–¹
   â”œâ”€ å‡†å¤‡åˆçº¦å‡çº§æˆ–è¿ç§»
   â”œâ”€ è½¬ç§» Owner æƒé™åˆ°å®‰å…¨åœ°å€
   â””â”€ å…¨é¢å®¡è®¡å’Œäº‹ååˆ†æ

```

#### åº”æ€¥è”ç³»æ¸…å•

```javascript
const emergencyContacts = {
    // æŠ€æœ¯å›¢é˜Ÿ
    technical: {
        lead: '+1-XXX-XXX-XXXX',
        oncall: '+1-XXX-XXX-XXXX',
        backup: '+1-XXX-XXX-XXXX',
    },

    // å®‰å…¨å›¢é˜Ÿ
    security: {
        ciso: '+1-XXX-XXX-XXXX',
        incident_response: '+1-XXX-XXX-XXXX',
    },

    // ä¸šåŠ¡å›¢é˜Ÿ
    business: {
        coo: '+1-XXX-XXX-XXXX',
        regional_us: '+1-XXX-XXX-XXXX',
        regional_eu: '+44-XXX-XXX-XXXX',
        regional_asia: '+86-XXX-XXX-XXXX',
    },

    // æ³•åŠ¡å’Œåˆè§„
    legal: {
        general_counsel: '+1-XXX-XXX-XXXX',
        compliance: '+1-XXX-XXX-XXXX',
    },

    // å¤–éƒ¨åˆä½œä¼™ä¼´
    external: {
        auditor: 'security@auditor.com',
        exchange_partners: 'partners@exchanges.com',
        regulatory: 'contact@regulator.gov',
    }
};
```

### 4. ğŸ“ˆ æ‰©å±•æ€§æœ€ä½³å®è·µ

#### æ·»åŠ æ–°åœ°åŒºçš„ Checklist

```markdown
## æ–°åœ°åŒºé“¸å¸é…ç½® Checklist

### å‡†å¤‡é˜¶æ®µ (T-1å‘¨)
- [ ] ç”Ÿæˆæ–°çš„ Controller åœ°å€ï¼ˆå¤šç­¾ï¼‰
- [ ] ç”Ÿæˆæ–°çš„ Minter åœ°å€ï¼ˆçƒ­é’±åŒ… + å¤‡ç”¨ï¼‰
- [ ] é…ç½®ç¡¬ä»¶é’±åŒ…å’Œå¤šç­¾å‚æ•°
- [ ] å»ºç«‹å½“åœ°è¿è¥å›¢é˜Ÿ
- [ ] åŸ¹è®­å½“åœ°å›¢é˜Ÿä½¿ç”¨é“¸å¸ç³»ç»Ÿ

### åˆè§„å®¡æŸ¥ (T-3å¤©)
- [ ] å®Œæˆå½“åœ°æ³•å¾‹åˆè§„å®¡æŸ¥
- [ ] è·å¾—å¿…è¦çš„è¿è¥è®¸å¯
- [ ] å»ºç«‹å½“åœ°ç›‘ç®¡æŠ¥å‘Šæµç¨‹
- [ ] å‡†å¤‡ KYC/AML æµç¨‹

### æŠ€æœ¯é…ç½® (T-1å¤©)
- [ ] åœ¨æµ‹è¯•ç½‘éªŒè¯é…ç½®
- [ ] Owner åœ¨ MasterMinter ä¸­é…ç½® Controller
- [ ] Controller è®¾ç½®åˆå§‹é“¸å¸é¢åº¦ï¼ˆä¿å®ˆï¼‰
- [ ] éªŒè¯ Minter å¯ä»¥æ­£å¸¸é“¸å¸
- [ ] é…ç½®ç›‘æ§å’Œå‘Šè­¦

### ä¸Šçº¿ (T-Day)
- [ ] å…¬å‘Šæ–°åœ°åŒºä¸Šçº¿
- [ ] å¼€å§‹å°é¢é“¸å¸æµ‹è¯•
- [ ] ç›‘æ§ç³»ç»Ÿç¨³å®šæ€§
- [ ] é€æ­¥å¢åŠ é“¸å¸é¢åº¦

### äº‹å (T+1å‘¨)
- [ ] å®¡æŸ¥é¦–å‘¨è¿è¥æ•°æ®
- [ ] ä¼˜åŒ–é¢åº¦é…ç½®
- [ ] æ”¶é›†å›¢é˜Ÿåé¦ˆ
- [ ] æ›´æ–°æ–‡æ¡£å’Œæµç¨‹
```

### 5. ğŸ” å®¡è®¡æœ€ä½³å®è·µ

#### å®šæœŸå®¡è®¡é¡¹ç›®

```javascript
const auditChecklist = {
    // æ¯æ—¥å®¡è®¡
    daily: {
        mintingActivity: 'é“¸å¸æ´»åŠ¨å®¡è®¡',
        allowanceChanges: 'é¢åº¦å˜æ›´å®¡è®¡',
        unusualPatterns: 'å¼‚å¸¸æ¨¡å¼æ£€æµ‹',
    },

    // æ¯å‘¨å®¡è®¡
    weekly: {
        controllerActions: 'æ§åˆ¶å™¨æ“ä½œå®¡è®¡',
        totalSupplyTrend: 'æ€»ä¾›åº”é‡è¶‹åŠ¿åˆ†æ',
        minterPerformance: 'Minter ç»©æ•ˆå®¡è®¡',
    },

    // æ¯æœˆå®¡è®¡
    monthly: {
        securityReview: 'å®‰å…¨å®¡æŸ¥',
        accessControl: 'è®¿é—®æ§åˆ¶å®¡è®¡',
        complianceCheck: 'åˆè§„æ£€æŸ¥',
    },

    // æ¯å­£åº¦å®¡è®¡
    quarterly: {
        externalAudit: 'å¤–éƒ¨å®¡è®¡',
        architectureReview: 'æ¶æ„å®¡æŸ¥',
        disasterRecoveryTest: 'ç¾å¤‡æ¼”ç»ƒ',
    }
};

// å®¡è®¡æŠ¥å‘Šç”Ÿæˆ
const generateAuditReport = async (period) => {
    const report = {
        period,
        timestamp: Date.now(),

        // é“¸å¸æ´»åŠ¨ç»Ÿè®¡
        mintingStats: {
            totalMinted: await getTotalMinted(period),
            totalBurned: await getTotalBurned(period),
            netIssuance: 0,  // calculated
            byRegion: {},
            byMinter: {},
        },

        // é¢åº¦å˜æ›´è®°å½•
        allowanceChanges: {
            increased: [],
            decreased: [],
            configured: [],
        },

        // æ§åˆ¶å™¨æ“ä½œè®°å½•
        controllerActions: {
            added: [],
            removed: [],
            modified: [],
        },

        // å¼‚å¸¸äº‹ä»¶
        incidents: {
            security: [],
            operational: [],
            compliance: [],
        },

        // å»ºè®®
        recommendations: [],
    };

    return report;
};
```

---

## æ€»ç»“

### ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

USDC çš„å››å±‚é“¸å¸ç®¡ç†æ¶æ„æ˜¯**ä¼ä¸šçº§æ™ºèƒ½åˆçº¦è®¾è®¡çš„å…¸èŒƒ**ï¼š

1. **ğŸ” å®‰å…¨æ€§**: æƒé™åˆ†å±‚ï¼Œé™ä½å•ç‚¹é£é™©
2. **ğŸš€ æ•ˆç‡**: æ—¥å¸¸è¿è¥æ— éœ€ Owner å‚ä¸
3. **ğŸŒ æ‰©å±•æ€§**: è½»æ¾æ·»åŠ æ–°åœ°åŒºå’Œä¸šåŠ¡çº¿
4. **ğŸ’° é£é™©æ§åˆ¶**: é¢åº¦æœºåˆ¶é™åˆ¶æ½œåœ¨æŸå¤±
5. **ğŸ›¡ï¸ å®¹é”™æ€§**: å¿«é€Ÿå“åº”å’Œç¾å¤‡èƒ½åŠ›
6. **ğŸ“Š å¯å®¡è®¡æ€§**: å®Œæ•´çš„æ“ä½œæ—¥å¿—é“¾
7. **ğŸŒ å…¨çƒåŒ–**: æ”¯æŒå¤šåœ°åŒºç‹¬ç«‹è¿è¥

### ğŸ† è®¾è®¡ç²¾é«“

```
æœ€å°æƒé™ + èŒè´£åˆ†ç¦» + çµæ´»ç®¡ç† + é¢åº¦æ§åˆ¶
                    â†“
    å®‰å…¨ã€é«˜æ•ˆã€å¯æ‰©å±•çš„é“¸å¸ç®¡ç†ç³»ç»Ÿ
```

### ğŸ“š å­¦ä¹ ä»·å€¼

è¿™ä¸ªæ¶æ„è®¾è®¡å¯¹å…¶ä»–é¡¹ç›®çš„å¯å‘ï¼š
- **DeFi åè®®**: å¤šè§’è‰²æƒé™ç®¡ç†
- **DAO æ²»ç†**: åˆ†å±‚å†³ç­–æœºåˆ¶
- **ä¼ä¸šåº”ç”¨**: åˆè§„å’Œå®¡è®¡å‹å¥½
- **å…¨çƒæœåŠ¡**: å¤šåœ°åŒºè¿è¥æ”¯æŒ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025å¹´12æœˆ17æ—¥
**ç»´æŠ¤è€…**: USDC æŠ€æœ¯å›¢é˜Ÿ

